{"componentChunkName":"component---src-templates-blog-post-js","path":"/wxa-effect-01/","result":{"data":{"site":{"siteMetadata":{"title":""}},"markdownRemark":{"id":"0d3a9a47-3212-596c-be37-deb2101aba9a","excerpt":"引入组件 使用 微信开发工具/详情/本地设置中，使用npm模块 微信开发工具/工具，构建npm wxml js json Tip 在官方demo少许改动 json中引用原版是”index-list”: “@miniprogram-component-plus/index-list”，但我尝试时是需要加/才可以引用 js…","html":"<h3>引入组件</h3>\n<div class=\"gatsby-highlight\" data-language=\"node\"><pre class=\"language-node\"><code class=\"language-node\">  npm init\n  npm i @miniprogram-component-plus/index-list --save</code></pre></div>\n<h3>使用</h3>\n<ul>\n<li>微信开发工具/详情/本地设置中，使用npm模块</li>\n<li>\n<p>微信开发工具/工具，构建npm</p>\n<h3>wxml</h3>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>index-list</span> <span class=\"token attr-name\">list</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>{{cities}}<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">bindchoose</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>chooseCity<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>index-list</span><span class=\"token punctuation\">></span></span></code></pre></div>\n</li>\n</ul>\n<h3>js</h3>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> QQMapWX <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./lib/qqmap-wx-jssdk.min.js\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> QQMapKey <span class=\"token operator\">=</span> <span class=\"token string\">\"NDLBZ-4Y6KF-S2LJ6-NAOAA-BOW56-LMB44\"</span>\n<span class=\"token keyword\">const</span> qqmapsdk <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QQMapWX</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  key<span class=\"token operator\">:</span> QQMapKey<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token function\">Page</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    cities<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">onLoad</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">getCities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">chooseCity</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>detail<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> pages <span class=\"token operator\">=</span> <span class=\"token function\">getCurrentPages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> prevPage <span class=\"token operator\">=</span> pages<span class=\"token punctuation\">[</span>pages<span class=\"token punctuation\">.</span>length <span class=\"token operator\">-</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n    prevPage<span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      city<span class=\"token operator\">:</span> e<span class=\"token punctuation\">.</span>detail<span class=\"token punctuation\">.</span>item<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    wx<span class=\"token punctuation\">.</span><span class=\"token function\">navigateBack</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      delta<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">getCities</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> _this <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span>\n    qqmapsdk<span class=\"token punctuation\">.</span><span class=\"token function\">getCityList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> cities <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n        <span class=\"token comment\">// 按拼音排序</span>\n        cities<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c1<span class=\"token punctuation\">,</span> c2</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">let</span> pinyin1 <span class=\"token operator\">=</span> c1<span class=\"token punctuation\">.</span>pinyin<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">let</span> pinyin2 <span class=\"token operator\">=</span> c2<span class=\"token punctuation\">.</span>pinyin<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">return</span> pinyin1<span class=\"token punctuation\">.</span><span class=\"token function\">localeCompare</span><span class=\"token punctuation\">(</span>pinyin2<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// 添加首字母</span>\n        <span class=\"token keyword\">const</span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> city <span class=\"token keyword\">of</span> cities<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> alpha <span class=\"token operator\">=</span> city<span class=\"token punctuation\">.</span>pinyin<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">charAt</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toUpperCase</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>map<span class=\"token punctuation\">.</span><span class=\"token function\">has</span><span class=\"token punctuation\">(</span>alpha<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> map<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span>alpha<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n          map<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>alpha<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            name<span class=\"token operator\">:</span> city<span class=\"token punctuation\">.</span>fullname<span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">const</span> keys <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> key <span class=\"token keyword\">of</span> map<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          keys<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        keys<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">const</span> list <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> key <span class=\"token keyword\">of</span> keys<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          list<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n            alpha<span class=\"token operator\">:</span> key<span class=\"token punctuation\">,</span>\n            subItems<span class=\"token operator\">:</span> map<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        _this<span class=\"token punctuation\">.</span><span class=\"token function\">setData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          cities<span class=\"token operator\">:</span> list<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>json</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"usingComponents\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token property\">\"index-list\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/@miniprogram-component-plus/index-list\"</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Tip</h3>\n<ul>\n<li>在官方demo少许改动</li>\n<li>json中引用原版是”index-list”: “@miniprogram-component-plus/index-list”，但我尝试时是需要加/才可以引用</li>\n<li>js中QQMapKey需要自己注册</li>\n<li>js中引用的<a href=\"/cb25c8b735464ecacc3e96afa3007acc/qqmap-wx-jssdk.min.js\">qqmap-wx-jssdk.min.js</a></li>\n</ul>","frontmatter":{"title":"微信小程序城市选择","date":"April 24, 2020","description":"首字母查询 微信小程序 index-list"}}},"pageContext":{"slug":"/wxa-effect-01/","previous":{"fields":{"slug":"/rn-effect-03/"},"frontmatter":{"title":"RN 扫码功能"}},"next":{"fields":{"slug":"/wxa-effect-03/"},"frontmatter":{"title":"微信小程序固定钉"}}}}}