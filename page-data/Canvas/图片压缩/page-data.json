{"componentChunkName":"component---src-templates-blog-post-js","path":"/Canvas/图片压缩/","result":{"data":{"site":{"siteMetadata":{"title":""}},"markdownRemark":{"id":"c472d7ce-1a59-5652-8630-04b34f3a8107","excerpt":"","html":"<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">compress</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">img</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> canvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> ctx <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">let</span> tCanvas <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> tctx <span class=\"token operator\">=</span> tCanvas<span class=\"token punctuation\">.</span><span class=\"token function\">getContext</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"2d\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">let</span> initSize <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>src<span class=\"token punctuation\">.</span>length\n  <span class=\"token keyword\">let</span> width <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>width\n  <span class=\"token keyword\">let</span> height <span class=\"token operator\">=</span> img<span class=\"token punctuation\">.</span>height\n\n  <span class=\"token keyword\">let</span> ratio\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ratio <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>width <span class=\"token operator\">*</span> height<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">4000000</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    ratio <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>ratio<span class=\"token punctuation\">)</span>\n    width <span class=\"token operator\">/=</span> ratio\n    height <span class=\"token operator\">/=</span> ratio\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    ratio <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n  <span class=\"token punctuation\">}</span>\n  canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> width\n  canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> height\n\n  ctx<span class=\"token punctuation\">.</span>fillStyle <span class=\"token operator\">=</span> <span class=\"token string\">\"#fff\"</span>\n  ctx<span class=\"token punctuation\">.</span><span class=\"token function\">fillRect</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>width<span class=\"token punctuation\">,</span> canvas<span class=\"token punctuation\">.</span>height<span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">let</span> count\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>width <span class=\"token operator\">*</span> height<span class=\"token punctuation\">)</span> <span class=\"token operator\">/</span> <span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    count <span class=\"token operator\">=</span> <span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">sqrt</span><span class=\"token punctuation\">(</span>count<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">let</span> nw <span class=\"token operator\">=</span> <span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token punctuation\">(</span>width <span class=\"token operator\">/</span> count<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">let</span> nh <span class=\"token operator\">=</span> <span class=\"token operator\">~</span><span class=\"token operator\">~</span><span class=\"token punctuation\">(</span>height <span class=\"token operator\">/</span> count<span class=\"token punctuation\">)</span>\n    tCanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> nw\n    tCanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> nh\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> count<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> count<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        tctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>\n          img<span class=\"token punctuation\">,</span>\n          i <span class=\"token operator\">*</span> nw <span class=\"token operator\">*</span> ratio<span class=\"token punctuation\">,</span>\n          j <span class=\"token operator\">*</span> nh <span class=\"token operator\">*</span> ratio<span class=\"token punctuation\">,</span>\n          nw <span class=\"token operator\">*</span> ratio<span class=\"token punctuation\">,</span>\n          nh <span class=\"token operator\">*</span> ratio<span class=\"token punctuation\">,</span>\n          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n          <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n          nw<span class=\"token punctuation\">,</span>\n          nh\n        <span class=\"token punctuation\">)</span>\n        ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>tCanvas<span class=\"token punctuation\">,</span> i <span class=\"token operator\">*</span> nw<span class=\"token punctuation\">,</span> j <span class=\"token operator\">*</span> nh<span class=\"token punctuation\">,</span> nw<span class=\"token punctuation\">,</span> nh<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    ctx<span class=\"token punctuation\">.</span><span class=\"token function\">drawImage</span><span class=\"token punctuation\">(</span>img<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">let</span> ndata <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">toDataURL</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"image/jpeg\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">)</span>\n  tCanvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> tCanvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>width <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n  <span class=\"token keyword\">return</span> ndata\n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"图片压缩","date":"April 01, 2022","description":"图片压缩,canvas"}}},"pageContext":{"slug":"/Canvas/图片压缩/","previous":{"fields":{"slug":"/Js/array/"},"frontmatter":{"title":"array"}},"next":{"fields":{"slug":"/Ethereum/ethereum/"},"frontmatter":{"title":"ethereum方法"}}}},"staticQueryHashes":["1246554614","2841359383"]}