{"componentChunkName":"component---src-templates-blog-post-js","path":"/ReactNative/android极光推送/","result":{"data":{"site":{"siteMetadata":{"title":""}},"markdownRemark":{"id":"3c402c7a-d401-5e70-9ac4-dcb542d7db45","excerpt":"android 推送集成 android/app/build.gradle android/build.gradle android/app/src/main/AndroidManifest.xml android/app/src/main/java/com/jpush 内部文件 JPushModule.java…","html":"<h3>android 推送集成</h3>\n<h5>android/app/build.gradle</h5>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">android <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token operator\">...</span>\n    defaultConfig <span class=\"token punctuation\">{</span>\n        applicationId <span class=\"token string\">\"com.xxx.xxx\"</span> <span class=\"token comment\">//JPush 上注册的包名.</span>\n        <span class=\"token operator\">...</span><span class=\"token operator\">...</span>\n\n\n        ndk <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">//选择要添加的对应 cpu 类型的 .so 库。</span>\n            abiFilters <span class=\"token string\">'armeabi'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'armeabi-v7a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'arm64-v8a'</span>\n            <span class=\"token comment\">// 还可以添加 'x86', 'x86_64', 'mips', 'mips64'</span>\n        <span class=\"token punctuation\">}</span>\n\n\n        manifestPlaceholders <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token constant\">JPUSH_PKGNAME</span> <span class=\"token operator\">:</span> applicationId<span class=\"token punctuation\">,</span>\n            <span class=\"token constant\">JPUSH_APPKEY</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"你的 Appkey \"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//JPush 上注册的包名对应的 Appkey.</span>\n            <span class=\"token constant\">JPUSH_CHANNEL</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"developer-default\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//暂时填写默认值即可.</span>\n        <span class=\"token punctuation\">]</span>\n        <span class=\"token operator\">...</span><span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span><span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\n\ndependencies <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span><span class=\"token operator\">...</span>\n    implementation <span class=\"token string\">'cn.jiguang.sdk:jpush:3.4.1'</span>  <span class=\"token comment\">// 此处以JPush 3.4.1 版本为例。</span>\n    implementation <span class=\"token string\">'cn.jiguang.sdk:jcore:2.2.4'</span>  <span class=\"token comment\">// 此处以JCore 2.2.4 版本为例。</span>\n    <span class=\"token operator\">...</span><span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>android/build.gradle</h5>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">buildscript<span class=\"token punctuation\">{</span>\n    repositories <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">jcenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>        <span class=\"token comment\">//添加</span>\n        <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span>\nallprojects<span class=\"token punctuation\">{</span>\n    repositories <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">jcenter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>        <span class=\"token comment\">//添加</span>\n        <span class=\"token operator\">...</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>android/app/src/main/AndroidManifest.xml</h5>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.permission.ACCESS_NETWORK_STATE<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.permission.MOUNT_UNMOUNT_FILESYSTEMS<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.permission.READ_EXTERNAL_STORAGE<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.permission.READ_PHONE_STATE<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.permission.INTERNET<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>android.permission.RECEIVE_USER_PRESENT<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>uses-permission</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.jkserver.permission.JPUSH_MESSAGE <span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!-- Since JCore2.0.0 Required SDK核心功能--></span>\n<span class=\"token comment\">&lt;!-- 可配置android:process参数将Service放在其他进程中；android:enabled属性不能是false --></span>\n<span class=\"token comment\">&lt;!-- 这个是自定义Service，要继承极光JCommonService，可以在更多手机平台上使得推送通道保持的更稳定 --></span>\n&lt;service android:name=“com.jpush.JPushService\"\nandroid:enabled=\"true\"\nandroid:exported=\"false\"\nandroid:process=\":pushcore\">\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cn.jiguang.user.service.action<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>service</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!-- Required since 3.0.7 --></span>\n<span class=\"token comment\">&lt;!-- 新的 tag/alias 接口结果返回需要开发者配置一个自定的广播 --></span>\n<span class=\"token comment\">&lt;!-- 3.3.0开始所有事件将通过该类回调 --></span>\n<span class=\"token comment\">&lt;!-- 该广播需要继承 JPush 提供的 JPushMessageReceiver 类, 并如下新增一个 Intent-Filter --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>receiver</span>\n<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>com.jpush.JUPushMessageReceiver<span class=\"token punctuation\">\"</span></span>\n<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>enabled</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span>\n<span class=\"token attr-name\"><span class=\"token namespace\">android:</span>exported</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>false<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>action</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>cn.jpush.android.intent.RECEIVE_MESSAGE<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>category</span> <span class=\"token attr-name\"><span class=\"token namespace\">android:</span>name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>您应用的包名<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>intent-filter</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>receiver</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h5>android/app/src/main/java/com/jpush 内部文件</h5>\n<p><a href=\"/12ae0af9d847d8db2da6ac61ddfc49ad/JPushModule.java\">JPushModule.java 下载</a></p>\n<p><a href=\"/e7a5b7681757bba3d874ed2688440783/JPushPackage.java\">JPushPackage.java 下载</a></p>\n<p><a href=\"/10d2f258f4f4f232560a75511b537cfa/JPushService.java\">JPushService.java 下载</a></p>\n<p><a href=\"/d0a509e3c0d1725e94223a9ee2ede36e/JUPushMessageReceiver.java\">JUPushMessageReceiver.java 下载</a></p>\n<h5>android/app/src/main/java/{appname}/MainApplication.java</h5>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">import</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>jpush<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">JPushPackage</span>    <span class=\"token comment\">//添加内容</span>\n<span class=\"token annotation punctuation\">@Override</span>\n<span class=\"token keyword\">protected</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactPackage</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getPackages</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactPackage</span><span class=\"token punctuation\">></span></span><span class=\"token function\">asList</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">JPushPackage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>    <span class=\"token comment\">//添加内容</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h5>混淆 android/app/proguard-rules.pro</h5>\n<div class=\"gatsby-highlight\" data-language=\"pro\"><pre class=\"language-pro\"><code class=\"language-pro\">-dontoptimize\n-dontpreverify\n-dontwarn cn.jpush.**\n-keep class cn.jpush.** { *; }\n-keep class * extends cn.jpush.android.helpers.JPushMessageReceiver { *; }\n-dontwarn cn.jiguang.**\n-keep class cn.jiguang.** { *; }\n\n2.0.5 ~ 2.1.7 版本有引入 gson 和 protobuf，增加排除混淆的配置。（2.1.8 版本不需配置）\n#==================gson &amp;&amp; protobuf==========================\n-dontwarn com.google.**\n-keep class com.google.gson.** {*;}\n-keep class com.google.protobuf.** {*;}</code></pre></div>","frontmatter":{"title":"RN android极光推送","date":"April 02, 2022","description":"react-native 极光推送 android"}}},"pageContext":{"slug":"/ReactNative/android极光推送/","previous":{"fields":{"slug":"/Html/视频切片上传/"},"frontmatter":{"title":"视频分片上传"}},"next":{"fields":{"slug":"/ReactNative/ios极光推送/"},"frontmatter":{"title":"RN ios极光推送"}}}},"staticQueryHashes":["1246554614","2841359383"]}